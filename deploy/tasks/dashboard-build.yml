- name: Start with docker compose
  docker_compose:
    project_src: "{{deploy_directory}}"
    build: yes
    remove_orphans: yes
  vars:
    ansible_python_interpreter: /usr/bin/python3
  environment:
    RAILS_ENV: production
  notify: refresh browser

- name: Precompile assets
  command: docker-compose exec rails rails assets:precompile
  args:
    chdir: "{{deploy_directory}}" 
  register: assets_out

- debug:
    var: assets_out

- name: Clean assets
  command: docker-compose exec rails rails assets:clean
  args:
    chdir: "{{deploy_directory}}" 
  register: assets_out

- debug:
    var: assets_out

- name: Rails db:migrate
  command: docker-compose exec rails rails db:migrate
  args:
    chdir: "{{deploy_directory}}" 
  register: db_migrate

- debug: var=db_migrate
